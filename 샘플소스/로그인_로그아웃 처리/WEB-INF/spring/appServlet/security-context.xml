<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-5.7.xsd
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">

	<context:component-scan base-package="com.min.edu" />

	<!-- 접근권한 미만 처리로직 Handler -->
	<bean id="customAccessDenied" class="com.min.edu.security.CustomAccessDeniedHandler"/>
	<!-- 로그인 성공 시 처리로직 Handler -->
	<bean id="customLoginSuccess" class="com.min.edu.security.CustomLoginSuccessHandler" />
	<!-- Spring Security API제공 암호화 -->
	<bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />
	<!-- 로그인 처리 서비스 -->
	<bean id="loginService" class="com.min.edu.security.LoginService" />
	
	<!--
	security:http : http 요청처리를 위한 보안구성 정의 
	auto-config="true" : Spring Security 보안설정을 자동으로 구성 적용처리
	-->
	<security:http auto-config="true" use-expressions="true">
		<!-- 접근제한 설정 : URL 단위로 매핑 -->
		<!-- 모든 사용자 접근 권한 -->
		<security:intercept-url pattern="/all.do" access="permitAll" />
		<!-- 일반회원 접근 권한 -->
		<security:intercept-url pattern="/member.do" access="hasAnyRole('USER','ADMIN','SYSADMIN')" />
		<!-- 관리자 접근 권한 -->
		<security:intercept-url pattern="/admin.do" access="hasAnyRole('ADMIN','SYSADMIN')" />
		<!-- 파일 특정명칭으로 관리자 권한부여 가능 -->
		<security:intercept-url pattern="/*Manager*.do" access="hasAnyRole('ADMIN','SYSADMIN')" />
		<!-- 시스템 권한 -->
		<security:intercept-url pattern="/system.do" access="hasRole('SYSADMIN')" />

		<!-- 
		login-page : 로그인 Custom Page 설정
		authentication-success-handler-ref : 로그인 성공handler 이동, 처리 로직 
		-->
		<security:form-login login-page="/loginForm.do" 
							 authentication-success-handler-ref="customLoginSuccess" />
		
		<!-- AccessDeniedHandler 등록 -->
		<security:access-denied-handler ref="customAccessDenied" />
	
		<!-- 
		logout 처리 
		logout-url			: 로그아웃 처리 URL
		logout-success-url	: 로그아웃 후 이동 Url
		invalidate-session	: 로그아웃 시 session을 무효화할 지 선택
		-->
		<security:logout logout-url="/logout.do"
						 logout-success-url="/index.jsp" 
						 invalidate-session="true" />

		<!-- csrf 사용여부(사이트간 위변조 방지를 위한 처리 - true : 미사용) -->
		<security:csrf disabled="false" />
		
		<!-- 
		key						: token 생성용 키값
		token-validity-seconds	: token의 유효 시간(10일)
		remember-me-parameter	: 로그인 화면에서 전달되는 remember-me 파라미터
		-->
		<security:remember-me key="HCM"
							  token-validity-seconds="864000" 
							  remember-me-parameter="remember-me"/>
	</security:http>

	<security:authentication-manager>
		<!-- loginService 인증 프로세스로 위임 -->
		<security:authentication-provider user-service-ref="loginService">
			<!-- Spring Security 암호화 bcryptPasswordEncoder 참조 -->
			<security:password-encoder ref="bcryptPasswordEncoder" />
		</security:authentication-provider>
	</security:authentication-manager>

</beans>
